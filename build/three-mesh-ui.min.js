(()=>{"use strict";var e={d:(t,s)=>{for(var r in s)e.o(s,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:s[r]})}};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),e.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var t={};e.r(t),e.d(t,{COLUMN:()=>c,COLUMN_REVERSE:()=>l,ROW:()=>h,ROW_REVERSE:()=>o,contentDirection:()=>d});var s={};e.r(s),e.d(s,{CENTER:()=>p,END:()=>w,START:()=>u,STRETCH:()=>C,alignItems:()=>f,warnAboutDeprecatedAlignItems:()=>g});var r={};e.r(r),e.d(r,{CENTER:()=>b,END:()=>v,SPACE_AROUND:()=>x,SPACE_BETWEEN:()=>k,SPACE_EVENLY:()=>R,START:()=>y,justifyContent:()=>U});var a={};e.r(a),e.d(a,{NORMAL:()=>F,NOWRAP:()=>T,PRE:()=>P,PRE_LINE:()=>O,PRE_WRAP:()=>E,WHITE_CHARS:()=>B,collapseWhitespaceOnInlines:()=>W,collapseWhitespaceOnString:()=>L,isValid:()=>H,newlineBreakability:()=>A,shouldBreak:()=>D});var i={};e.r(i),e.d(i,{CENTER:()=>j,JUSTIFY:()=>Y,JUSTIFY_CENTER:()=>J,JUSTIFY_LEFT:()=>$,JUSTIFY_RIGHT:()=>q,LEFT:()=>N,RIGHT:()=>X,textAlign:()=>K});const n=THREE,h="row",o="row-reverse",c="column",l="column-reverse";function d(e,t,s,r){let a=s,i="getWidth",n="x",h="y";0===t.indexOf(c)&&(i="getHeight",n="y",h="x");for(let t=0;t<e.childrenBoxes.length;t++){const s=e.childrenBoxes[t],o=s.id,c=s[i](),l=s.margin||0;a+=l*r,e.childrenPos[o]={[n]:a+c/2*r,[h]:0},a+=r*(c+l)}}const u="start",p="center",w="end",C="stretch";function f(e,t){const s=e.getAlignItems();-1===m.indexOf(s)&&console.warn(`alignItems === '${s}' is not supported`);let r="getWidth",a="x";0===t.indexOf(h)&&(r="getHeight",a="y");const i=e[r]()/2-(e.padding||0);e.childrenBoxes.forEach((n=>{let o;switch(s){case w:case"right":case"bottom":o=0===t.indexOf(h)?-i+n[r]()/2+(n.margin||0):i-n[r]()/2-(n.margin||0);break;case u:case"left":case"top":o=0===t.indexOf(h)?i-n[r]()/2-(n.margin||0):-i+n[r]()/2+(n.margin||0)}e.childrenPos[n.id][a]=o||0}))}function g(e){-1!==_.indexOf(e)&&console.warn(`alignItems === '${e}' is deprecated and will be remove in 7.x.x. Fallback are 'start'|'end'`)}const m=[u,p,w,C,"top","right","bottom","left"],_=["top","right","bottom","left"],y="start",b="center",v="end",x="space-around",k="space-between",R="space-evenly";function U(e,t,s,r){const a=e.getJustifyContent();-1===S.indexOf(a)&&console.warn(`justifyContent === '${a}' is not supported`);const i=0===t.indexOf("row")?"width":"height",n=e.getChildrenSideSum(i),h=("width"===i?e.getInnerWidth():e.getInnerHeight())-n,o=function(e,t){switch(e){case v:return t;case b:return t/2}return 0}(a,2*s-n*Math.sign(s)),c=function(e,t,s,r){const a=Array(e.length).fill(0);if(t>0)switch(s){case k:if(e.length>1){const s=t/(e.length-1)*r;a[0]=0;for(let t=1;t<e.length;t++)a[t]=s*t}break;case R:if(e.length>1){const s=t/(e.length+1)*r;for(let t=0;t<e.length;t++)a[t]=s*(t+1)}break;case x:if(e.length>1){const s=t/e.length*r,i=s/2;a[0]=i;for(let t=1;t<e.length;t++)a[t]=i+s*t}}return a}(e.childrenBoxes,h,a,r),l=0===t.indexOf("row")?"x":"y";e.childrenBoxes.forEach(((t,s)=>{e.childrenPos[t.id][l]-=o-c[s]}))}const S=[y,b,v,x,k,R];function I(e){return class extends e{constructor(e){super(e),this.isBoxComponent=!0,this.childrenPos={}}getInnerWidth(){const e=this.getContentDirection();switch(e){case"row":case"row-reverse":return this.width-(2*this.padding||0)||this.getChildrenSideSum("width");case"column":case"column-reverse":return this.getHighestChildSizeOn("width");default:console.error(`Invalid contentDirection : ${e}`)}}getInnerHeight(){const e=this.getContentDirection();switch(e){case"row":case"row-reverse":return this.getHighestChildSizeOn("height");case"column":case"column-reverse":return this.height-(2*this.padding||0)||this.getChildrenSideSum("height");default:console.error(`Invalid contentDirection : ${e}`)}}getChildrenSideSum(e){return this.childrenBoxes.reduce(((t,s)=>{const r=2*s.margin||0;return t+("width"===e?s.getWidth()+r:s.getHeight()+r)}),0)}setPosFromParentRecords(){this.parentUI&&this.parentUI.childrenPos[this.id]&&(this.position.x=this.parentUI.childrenPos[this.id].x,this.position.y=this.parentUI.childrenPos[this.id].y)}computeChildrenPosition(){if(this.children.length>0){const e=this.getContentDirection();let t;switch(e){case h:t=-this.getInnerWidth()/2;break;case o:t=this.getInnerWidth()/2;break;case c:t=this.getInnerHeight()/2;break;case l:t=-this.getInnerHeight()/2}const s=-Math.sign(t);d(this,e,t,s),U(this,e,t,s),f(this,e)}}getHighestChildSizeOn(e){return this.childrenBoxes.reduce(((t,s)=>{const r=s.margin||0,a="width"===e?s.getWidth()+2*r:s.getHeight()+2*r;return Math.max(t,a)}),0)}getWidth(){return this.parentUI&&"stretch"===this.parentUI.getAlignItems()&&-1!==this.parentUI.getContentDirection().indexOf("column")?this.parentUI.getWidth()-(2*this.parentUI.padding||0):this.width||this.getInnerWidth()+(2*this.padding||0)}getHeight(){return this.parentUI&&"stretch"===this.parentUI.getAlignItems()&&-1!==this.parentUI.getContentDirection().indexOf("row")?this.parentUI.getHeight()-(2*this.parentUI.padding||0):this.height||this.getInnerHeight()+(2*this.padding||0)}}}const B={"\t":"\t","\n":"\n","\r":"\r"," ":" "},F="normal",T="nowrap",P="pre",O="pre-line",E="pre-wrap",z=[F,T,P,O,E];function H(e){return-1===z.indexOf(e)&&(console.warn(`Whitespace::isValid() The provided white-space value ('${e}') is not valid !`),console.warn(`    - Automatic fallback to ('${O}')`),e=O),e}const L=function(e,t){switch(t){case T:case F:e=e.replace(/\n/g," ");case O:e=e.replace(/[ ]{2,}/g," ")}return e},A=function(e){switch(e){case P:case E:case O:return"mandatory"}return null},D=function(e,t,s,r){const a=e[t];switch(r.WHITESPACE){case F:case O:case E:if("mandatory"===a.lineBreak)return!0;if(s+a.xadvance+a.xoffset+a.kerning>r.INNER_WIDTH)return!0;const i=G(e,t,r);return function(e,t,s,r){return!(!e||!e.char)&&(!(t+s<r.INNER_WIDTH)&&r.BREAKON.indexOf(e.char)>-1)}(e[t-1],s,i,r);case P:return"mandatory"===a.lineBreak;default:return!1}},W=function(e,t){const s=e[0],r=e[e.length-1];switch(t){case E:s.char&&"\n"===s.char&&e.length>1&&V([s],e[1]),r.char&&"\n"===r.char&&e.length>1&&M([r],e[e.length-2]);break;case O:case T:case F:let a,i=[];for(let t=0;t<e.length;t++){const s=e[t];if(!(s.char&&B[s.char]&&e.length>t))break;i.push(s),a=e[t+1]}V(i,a),i=[],a=null;for(let t=e.length-1;t>0;t--){const s=e[t];if(!(s.char&&B[s.char]&&t>0))break;i.push(s),a=e[t-1]}M(i,a);break;case P:break;default:return console.warn(`whiteSpace: '${t}' is not valid`),0}return s.offsetX};function M(e,t){if(t)for(let s=0;s<e.length;s++){const r=e[s];r.fontFactor=0,r.offsetX=t.offsetX+t.width}}function V(e,t){if(t)for(let s=0;s<e.length;s++){const r=e[s];r.fontFactor=0,r.offsetX=t.offsetX}}function G(e,t,s,r){if(r=r||0,!e[t])return r;const a=e[t];return a.lineBreak?r+a.xadvance:G(e,t+1,s,r+a.xadvance+a.xoffset+a.kerning+s.LETTERSPACING)}const N="left",X="right",j="center",Y="justify",$="justify-left",q="justify-right",J="justify-center";function K(e,t,s){for(let r=0;r<e.length;r++){const a=e[r],i=Q(a,t,s,r===e.length-1);for(let e=0;e<a.length;e++)a[e].offsetX+=i}if(0===t.indexOf(Y))for(let r=0;r<e.length;r++){const a=e[r];if(-1!==t.indexOf("-")&&r===e.length-1)return;const i=s-a.width;if(i<=0)return;let n=0;for(let e=1;e<a.length-1;e++)n+=" "===a[e].char?1:0;const h=i/n;let o=1;t===q&&(a.reverse(),o=-1);let c=0;for(let e=1;e<=a.length-1;e++){const t=a[e];t.offsetX+=c*o,c+=" "===t.char?h:0}t===q&&a.reverse()}}const Q=(e,t,s,r)=>{switch(t){case $:case Y:case N:return-s/2;case q:case X:return-e.width+s/2;case j:return-e.width/2;case J:return r?-e.width/2:-s/2;default:console.warn(`textAlign: '${t}' is not valid`)}};function Z(e){return class extends e{computeInlinesPosition(){const e=this.getWidth()-(2*this.padding||0),t=this.getHeight()-(2*this.padding||0),s=this.getJustifyContent(),r=this.getTextAlign(),a=this.getInterLine(),i=this.computeLines();let n=i.reduce(((e,t,s,r)=>{const i=t.lineHeight-t.lineBase;return t.forEach((s=>{s.offsetY=e-t.lineHeight+i+r[0].lineHeight})),e-t.lineHeight-a}),0)+a;n=Math.abs(n);const h=(()=>{switch(s){case"start":return t/2-i[0].lineHeight;case"end":return n-i[0].lineHeight-t/2+(i[i.length-1].lineHeight-i[i.length-1].lineHeight);case"center":return n/2-i[0].lineHeight;default:console.warn(`justifyContent: '${s}' is not valid`)}})();i.forEach((e=>{e.forEach((e=>{e.offsetY+=h}))})),K(i,r,e),this.lines=i}calculateBestFit(e){if(0!==this.childrenInlines.length)switch(e){case"grow":this.calculateGrowFit();break;case"shrink":this.calculateShrinkFit();break;case"auto":this.calculateAutoFit()}}calculateGrowFit(){const e=this.getHeight()-(2*this.padding||0);let t=1;const s=this.childrenInlines.find((e=>e.isText));let r,a=1,i=2,n=s._fitFontSize?s._fitFontSize/s.getFontSize():1;do{if(r=this.calculateHeight(n),r>e){if(n<=a){this.childrenInlines.forEach((e=>{e.isInlineBlock||(e._fitFontSize=e.getFontSize())}));break}i=n,n-=(i-a)/2}else{if(Math.abs(e-r)<.075)break;Math.abs(n-i)<5e-10&&(i*=2),a=n,n+=(i-a)/2}}while(++t<=10)}calculateShrinkFit(){const e=this.getHeight()-(2*this.padding||0);let t=1;const s=this.childrenInlines.find((e=>e.isText));let r,a=0,i=1,n=s._fitFontSize?s._fitFontSize/s.getFontSize():1;do{if(r=this.calculateHeight(n),r>e)i=n,n-=(i-a)/2;else{if(n>=i){this.childrenInlines.forEach((e=>{e.isInlineBlock||(e._fitFontSize=e.getFontSize())}));break}if(Math.abs(e-r)<.075)break;a=n,n+=(i-a)/2}}while(++t<=10)}calculateAutoFit(){const e=this.getHeight()-(2*this.padding||0);let t=1;const s=this.childrenInlines.find((e=>e.isText));let r,a=0,i=2,n=s._fitFontSize?s._fitFontSize/s.getFontSize():1;do{if(r=this.calculateHeight(n),r>e)i=n,n-=(i-a)/2;else{if(Math.abs(e-r)<.075)break;Math.abs(n-i)<5e-10&&(i*=2),a=n,n+=(i-a)/2}}while(++t<=10)}computeLines(){const e=this.getWidth()-(2*this.padding||0),t=[[]];return this.childrenInlines.reduce(((s,r)=>{if(!r.inlines)return;const a=r._fitFontSize||r.getFontSize(),i=r.isText?r.getLetterSpacing()*a:0,n=r.getWhiteSpace(),h=r.getBreakOn(),o={WHITESPACE:n,LETTERSPACING:i,BREAKON:h,INNER_WIDTH:e};return r.inlines.reduce(((e,s,r,a)=>D(a,r,e,o)?(t.push([s]),s.offsetX=s.xoffset,0===s.width?0:s.xadvance+i):(t[t.length-1].push(s),s.offsetX=e+s.xoffset+s.kerning,e+s.xadvance+s.kerning+i)),s)}),0),t.forEach((e=>{e.lineHeight=e.reduce(((e,t)=>{const s=void 0!==t.lineHeight?t.lineHeight:t.height;return Math.max(e,s)}),0),e.lineBase=e.reduce(((e,t)=>{const s=void 0!==t.lineBase?t.lineBase:t.height;return Math.max(e,s)}),0),e.width=0;if(e[0]){const t=this.getWhiteSpace(),s=W(e,t);e.forEach((e=>{e.offsetX-=s})),e.width=this.computeLineWidth(e)}})),t}calculateHeight(e){this.childrenInlines.forEach((t=>{t.isInlineBlock||(t._fitFontSize=t.getFontSize()*e,t.calculateInlines(t._fitFontSize))}));const t=this.computeLines(),s=this.getInterLine(),r=t.reduce(((e,t)=>e-t.lineHeight-s),0)+s;return Math.abs(r)}computeLineWidth(e){const t=e[0],s=e[e.length-1];return s.offsetX+s.width+t.offsetX}}}class ee extends n.EventDispatcher{constructor(e,t){super(),this._isReady=!1,this._weight=e,this._style=t,this._size=42,this._lineHeight=42,this._lineBase=42,this._font=null}get typographic(){return this._font}get isReady(){return this._isReady}get weight(){return this._weight}get style(){return this._style}get texture(){return this._texture}get id(){return`${this._name}(w:${this.weight},s:${this.style})`}getTypographyCharacter(e){let t=this._chars[e];if(t)return t;if(e.match(/\s/))return this._chars[" "];const s=le.missingCharacter(this,e);if(s&&(t=this._chars[s],t))return t;throw Error(`FontVariant('${this.id}')::getTypographyCharacter() - character('${e}') and/or fallback character were not found in provided msdf charset.`)}getGeometryCharacter(e){throw new Error(`FontVariant(${typeof this})::getGeometryCharacter() is abstract and should therefore be overridden.`)}getKerningAmount(e){return this._kernings[e]?this._kernings[e]:0}adjustTypographyCharacters(e){for(const t in e){const s=this.getTypographyCharacter(t),r=e[t];for(const a in r)s["_"+a]=e[t][a]}}_checkReadiness(){var e;this._readyCondition()&&((e=this)._isReady=!0,e.dispatchEvent(te))}_readyCondition(){throw new Error(`FontVariant(${typeof this})::_readyCondition() is abstract and should therefore be overridden.`)}}const te={type:"ready"};class se extends class{constructor(){this._size=42,this._lineHeight=42,this._lineBase=38,this._name="-",this._charset=""}get size(){return this._size}get lineHeight(){return this._lineHeight}get lineBase(){return this._lineBase}get name(){return this._name}get charset(){return this._charset}}{constructor(e){super(),this._size=e.info.size,this._lineHeight=e.common.lineHeight,this._lineBase=e.common.base,this._name=e.info.face,this._textureWidth=e.common.scaleW,this._textureHeight=e.common.scaleH,this._charset=e.chars.map((e=>e.char)).join("")}get textureWidth(){return this._textureWidth}get textureHeight(){return this._textureHeight}}class re extends class{constructor(e){this._typographic=e,this._fontFactor=1,this._lineBreak=null,this._fontSize=0,this._kerning=0,this._offsetX=0,this._offsetY=0}get typographic(){return this._typographic}resetOffsets(){this._offsetX=this._offsetY=0}get xadvance(){return this._typographic.xadvance*this._fontFactor}get xoffset(){return this._typographic.xoffset*this._fontFactor}get yoffset(){return this._typographic.yoffset*this._fontFactor}get width(){return this._typographic.width*this._fontFactor}get height(){return this._typographic.height*this._fontFactor}get char(){return this._typographic.char}set lineBreak(e){this._lineBreak=e}get lineBreak(){return this._lineBreak}get anchor(){const e=this._typographic.font.lineHeight,t=this._typographic.font.lineBase;return(this._typographic.yoffset+this._typographic.height-t)*this._fontSize/e}get kerning(){return this._kerning*this._fontFactor}set kerning(e){this._kerning=e}get fontSize(){return this._fontSize}set fontSize(e){this._fontSize=e}get lineHeight(){return this._typographic.font.lineHeight*this._fontFactor}get offsetX(){return this._offsetX}set offsetX(e){this._offsetX=e}get offsetY(){return this._offsetY}set offsetY(e){this._offsetY=e}get lineBase(){return this._typographic.font.lineBase*this._fontFactor}set fontFactor(e){this._fontFactor=e}}{constructor(e){super(e)}get uv(){return this.typographic.uv}}class ae extends class{constructor(e){this._char="",this._width=this._heigth=this._xadvance=1,this._xoffset=this._yoffset=0,this._font=e}get font(){return this._font}get char(){return this._char}get width(){return this._width}get height(){return this._heigth}get xadvance(){return this._xadvance}get xoffset(){return this._xoffset}get yoffset(){return this._yoffset}set yoffset(e){this._yoffset=e}asInlineCharacter(){throw new Error("Abstract... Need to be implemented")}}{constructor(e,t){super(e),this._char=t.char,this._width=t.width,this._heigth=t.height,this._xadvance=t.xadvance?t.xadvance:this._width,this._xoffset=t.xoffset?t.xoffset:0,this._yoffset=t.yoffset?t.yoffset:0,this._uv=null,isNaN(t.x)||(this._uv={left:t.x/e.textureWidth,right:(t.x+t.width)/e.textureWidth,top:1-(t.y+t.height)/e.textureHeight,bottom:1-t.y/e.textureHeight})}get uv(){return this._uv}asInlineCharacter(){return new re(this)}}class ie extends n.PlaneBufferGeometry{constructor(e){super(e.width,e.height),e.uv?(this.mapUVs(e),this.transformGeometry(e)):(this.nullifyUVs(),this.scale(0,0,1),this.translate(0,e.fontSize/2,0))}mapUVs(e){const t=this.attributes.uv;for(let s=0;s<t.count;s++){let r=t.getX(s),a=t.getY(s);[r,a]=(()=>{switch(s){case 0:return[e.uv.left,e.uv.bottom];case 1:return[e.uv.right,e.uv.bottom];case 2:return[e.uv.left,e.uv.top];case 3:return[e.uv.right,e.uv.top]}})(),t.setXY(s,r,a)}}nullifyUVs(){const e=this.attributes.uv;for(let t=0;t<e.count;t++)e.setXY(t,0,0)}transformGeometry(e){this.translate(e.width/2,e.height/2-e.anchor,0)}}class ne extends ee{constructor(e,t,s,r){var a,i;super(e,t),s.pages?this._buildData(s):(a=this,i=s,(new n.FileLoader).setResponseType("json").load(i,(e=>{a._buildData(e),a._checkReadiness()}))),r instanceof n.Texture?this._buildTexture(r):function(e,t){(new n.TextureLoader).load(t,(t=>{e._buildTexture(t),e._checkReadiness()}))}(this,r),this._checkReadiness()}get texture(){return this._texture}_buildData(e){this._font=new se(e),this._kernings=this._buildKerningPairs(e),this._chars=this._buildCharacters(e),this._chars[" "]=this._buildCharacterWhite(e),this._size=e.info.size,this._lineHeight=e.common.lineHeight,this._lineBase=e.common.base}_buildTexture(e){this._texture=e,e.generateMipmaps=!1,e.minFilter=n.LinearFilter,e.magFilter=n.LinearFilter,e.needsUpdate=!0}getGeometryCharacter(e){return new ie(e)}_readyCondition(){return this._chars&&this._texture}_buildKerningPairs(e){const t={};for(let s=0;s<e.kernings.length;s++){const r=e.kernings[s];if(0===r.amount)continue;t[String.fromCharCode(r.first,r.second)]=r.amount}return t}_buildCharacters(e){const t={};for(let s=0;s<e.chars.length;s++){const r=e.chars[s];t[r.char]=new ae(this._font,r)}return t}_buildCharacterWhite(e){return new ae(this._font,{char:" ",width:e.info.size/3,height:.7*e.info.size})}}class he extends n.EventDispatcher{constructor(e){super(),this._name=e,this._variants=[],this._isReady=!1}get isReady(){return this._isReady}addVariant(e,t,s,r,a=!1){if(a||!this.getVariant(e,t)){this._isReady=!1;const a=new ne(e,t,s,r);this._variants.push(a),a.isReady?this._checkReadiness():a.addEventListener("ready",this._checkReadiness)}else console.warn(`FontFamily('${this._name}')::addVariant() - Variant(${e}, ${t}) already exists.`);return this}addCustomImplementationVariant(e,t=!1){return t||!this.getVariant(e.weight,e.style)?(this._isReady=!1,this._variants.push(e),e.isReady?this._checkReadiness():e.addEventListener("ready",this._checkReadiness)):console.warn(`FontFamily('${this._name}')::addCustomImplementationVariant() - Variant(${e.weight}, ${e.style}) already exists.`),this}getVariant(e,t){return this._variants.find((s=>s.weight===e&&s.style===t))}get name(){return this._name}_checkReadiness=()=>{var e;this._variants.every((e=>e.isReady))&&((e=this)._isReady=!0,e.dispatchEvent(oe))}}const oe={type:"ready"};const ce={};const le={addFontFamily:function(e){return ce[e]&&console.error(`FontLibrary::addFontFamily - Font('${e}') is already registered`),ce[e]=new he(e),ce[e]},getFontFamily:function(e){return ce[e]},prepare:function(e){const t=[...arguments];t.forEach((e=>{if(!(e instanceof he))throw new Error(`FontLibrary::prepare() - One of the provided parameter is not a FontFamily. Instead ${typeof e} given.`)}));const s=function(){return t.every((e=>e.isReady))};return new Promise(((e,r)=>{if(s())e();else for(let r=0;r<t.length;r++){const a=t[r];a.isReady||a.addEventListener("ready",(()=>{s()&&e()}))}}))},setMissingCharacterHandler:function(e){de=e},missingCharacter:function(e,t){return de(e,t)}};let de=function(e,t){return console.error(`The character '${t}' is not included in the font characters set.`)," "};class ue{static requestUpdate(e,t,s,r){e.traverse((e=>{e.isUI&&(this.requestedUpdates[e.id]?(t&&(this.requestedUpdates[e.id].updateParsing=!0),s&&(this.requestedUpdates[e.id].updateLayout=!0),r&&(this.requestedUpdates[e.id].updateInner=!0)):this.requestedUpdates[e.id]={updateParsing:t,updateLayout:s,updateInner:r,needCallback:t||s||r})}))}static register(e){this.components.includes(e)||this.components.push(e)}static disposeOf(e){const t=this.components.indexOf(e);t>-1&&this.components.splice(t,1)}static update(){if(Object.keys(this.requestedUpdates).length>0){const e=this.components.filter((e=>!e.parentUI));e.forEach((e=>this.traverseParsing(e))),e.forEach((e=>this.traverseUpdates(e)))}}static traverseParsing(e){const t=this.requestedUpdates[e.id];t&&t.updateParsing&&(e.parseParams(),t.updateParsing=!1),e.childrenUIs.forEach((e=>this.traverseParsing(e)))}static traverseUpdates(e){const t=this.requestedUpdates[e.id];delete this.requestedUpdates[e.id],t&&t.updateLayout&&(t.updateLayout=!1,e.updateLayout()),t&&t.updateInner&&(t.updateInner=!1,e.updateInner()),e.childrenUIs.forEach((e=>{this.traverseUpdates(e)})),t&&t.needCallback&&e.onAfterUpdate()}}ue.components=[],ue.requestedUpdates={};const pe="400",we="normal";const Ce={container:null,fontFamily:null,fontSize:.05,fontKerning:"normal",fontStyle:we,fontWeight:pe,bestFit:"none",offset:.01,interLine:.01,breakOn:"- ,.:?!\n",whiteSpace:O,contentDirection:c,alignItems:p,justifyContent:y,fontTexture:null,textAlign:j,fontColor:new n.Color(16777215),fontOpacity:1,fontPXRange:4,fontSupersampling:!0,borderRadius:.01,borderWidth:0,borderColor:new n.Color("black"),borderOpacity:1,backgroundSize:"cover",backgroundColor:new n.Color(2236962),backgroundWhiteColor:new n.Color(16777215),backgroundOpacity:.8,backgroundOpaqueOpacity:1,backgroundTexture:function(){if(!fe){const e=document.createElement("canvas").getContext("2d");e.canvas.width=1,e.canvas.height=1,e.fillStyle="#ffffff",e.fillRect(0,0,1,1),fe=new n.CanvasTexture(e.canvas),fe.isDefault=!0}return fe},hiddenOverflow:!1,letterSpacing:0};let fe;function ge(e){return class extends e{constructor(e){super(e),this.states={},this.currentState=void 0,this.isUI=!0,this.autoLayout=!0,this.childrenUIs=[],this.childrenBoxes=[],this.childrenTexts=[],this.childrenInlines=[],this.parentUI=null,this.addEventListener("added",this._rebuildParentUI),this.addEventListener("removed",this._rebuildParentUI)}getClippingPlanes(){const e=[];if(this.parentUI){if(this.isBlock&&this.parentUI.getHiddenOverflow()){const t=this.parentUI.getHeight()/2-(this.parentUI.padding||0),s=this.parentUI.getWidth()/2-(this.parentUI.padding||0),r=[new n.Plane(new n.Vector3(0,1,0),t),new n.Plane(new n.Vector3(0,-1,0),t),new n.Plane(new n.Vector3(1,0,0),s),new n.Plane(new n.Vector3(-1,0,0),s)];r.forEach((e=>{e.applyMatrix4(this.parent.matrixWorld)})),e.push(...r)}this.parentUI.parentUI&&e.push(...this.parentUI.getClippingPlanes())}return e}getHighestParent(){return this.parentUI?this.parent.getHighestParent():this}_getProperty(e){return void 0===this[e]&&this.parentUI?this.parent._getProperty(e):void 0!==this[e]?this[e]:Ce[e]}getFontSize(){return this._getProperty("fontSize")}getFontKerning(){return this._getProperty("fontKerning")}getFontStyle(){return this._getProperty("fontStyle")}getFontWeight(){return this._getProperty("fontWeight")}getLetterSpacing(){return this._getProperty("letterSpacing")}getFontTexture(){return this._font&&this._font.isReady?this._font.texture:this._getProperty("fontTexture")}getFontFamily(){return this._getProperty("fontFamily")}getBreakOn(){return this._getProperty("breakOn")}getWhiteSpace(){return this._getProperty("whiteSpace")}getTextAlign(){return this._getProperty("textAlign")}getFontColor(){return this._getProperty("fontColor")}getFontSupersampling(){return this._getProperty("fontSupersampling")}getFontOpacity(){return this._getProperty("fontOpacity")}getFontPXRange(){return this._getProperty("fontPXRange")}getBorderRadius(){return this._getProperty("borderRadius")}getBorderWidth(){return this._getProperty("borderWidth")}getBorderColor(){return this._getProperty("borderColor")}getBorderOpacity(){return this._getProperty("borderOpacity")}getContainer(){return!this.threeOBJ&&this.parent?this.parent.getContainer():this.threeOBJ?this:Ce.container}getParentsNumber(e){return e=e||0,this.parentUI?this.parentUI.getParentsNumber(e+1):e}getBackgroundOpacity(){return this.backgroundOpacity||0===this.backgroundOpacity?this.backgroundOpacity:Ce.backgroundOpacity}getBackgroundColor(){return this.backgroundColor||Ce.backgroundColor}getBackgroundTexture(){return this.backgroundTexture||Ce.backgroundTexture()}getAlignContent(){return this.alignContent||Ce.alignContent}getAlignItems(){return this.alignItems||Ce.alignItems}getContentDirection(){return this.contentDirection||Ce.contentDirection}getJustifyContent(){return this.justifyContent||Ce.justifyContent}getInterLine(){return void 0===this.interLine?Ce.interLine:this.interLine}getOffset(){return void 0===this.offset?Ce.offset:this.offset}getBackgroundSize(){return void 0===this.backgroundSize?Ce.backgroundSize:this.backgroundSize}getHiddenOverflow(){return void 0===this.hiddenOverflow?Ce.hiddenOverflow:this.hiddenOverflow}getBestFit(){return void 0===this.bestFit?Ce.bestFit:this.bestFit}_rebuildChildrenLists(){this.childrenUIs=this.children.filter((e=>e.isUI)),this.childrenBoxes=this.children.filter((e=>e.isBoxComponent)),this.childrenInlines=this.children.filter((e=>e.isInline)),this.childrenTexts=this.children.filter((e=>e.isText))}_rebuildParentUI=()=>{this.parent&&this.parent.isUI?this.parentUI=this.parent:this.parentUI=null};add(){for(const e of Object.keys(arguments))arguments[e].isInline&&this.update(null,!0);const e=super.add(...arguments);return this._rebuildChildrenLists(),e}remove(){for(const e of Object.keys(arguments))arguments[e].isInline&&this.update(null,!0);const e=super.remove(...arguments);return this._rebuildChildrenLists(),e}update(e,t,s){ue.requestUpdate(this,e,t,s)}onAfterUpdate(){}set(e){let t,s,r;if(ue.register(this),e&&JSON.stringify(e)!==JSON.stringify({})){e.alignContent&&(e.alignItems=e.alignContent,e.textAlign||(e.textAlign=e.alignContent),console.warn("`alignContent` property has been deprecated, please rely on `alignItems` and `textAlign` instead."),delete e.alignContent),e.alignItems&&g(e.alignItems);for(const a of Object.keys(e))if(this[a]!=e[a])switch(a){case"content":case"fontWeight":case"fontStyle":case"whiteSpace":this.isText&&(t=!0),s=!0,this[a]=e[a];break;case"fontSize":case"fontKerning":case"breakOn":case"margin":case"contentDirection":case"justifyContent":case"alignContent":case"alignItems":case"textAlign":case"textType":s=!0,this[a]=e[a];break;case"bestFit":this.isBlock&&(t=!0,s=!0),this[a]=e[a];break;case"width":case"height":case"padding":(this.isInlineBlock||this.isBlock&&"none"!=this.getBestFit())&&(t=!0),s=!0,this[a]=e[a];break;case"letterSpacing":case"interLine":this.isBlock&&"none"!=this.getBestFit()&&(t=!0),s=!0,this[a]=e[a];break;case"fontColor":case"fontOpacity":case"fontSupersampling":case"offset":case"backgroundColor":case"backgroundOpacity":case"backgroundTexture":case"backgroundSize":case"borderRadius":case"borderWidth":case"borderColor":case"borderOpacity":r=!0,this[a]=e[a];break;case"hiddenOverflow":this[a]=e[a]}if(e.fontFamily instanceof he)this.fontFamily=e.fontFamily,this.font=e.fontFamily.getVariant(pe,we);else if("string"!=typeof e.fontFamily||e.fontTexture){if(e.fontFamily&&e.fontTexture){const t=e.fontFamily.pages?e.fontFamily.info.face:e.fontFamily;let s=le.getFontFamily(t);s||(s=le.addFontFamily(t).addVariant(pe,we,e.fontFamily,e.fontTexture)),this.fontFamily=s,this.font=s.getVariant(pe,we)}}else{const t=le.getFontFamily(e.fontFamily);t&&(this.fontFamily=t,this.font=t.getVariant(pe,we))}this.parentUI&&"none"!=this.parentUI.getBestFit()&&this.parentUI.update(!0,!0,!1),this.update(t,s,r),s&&this.getHighestParent().update(!1,!0,!1)}}setupState(e){this.states[e.state]={attributes:e.attributes,onSet:e.onSet}}setState(e){const t=this.states[e];t?e!==this.currentState&&(this.currentState=e,t.onSet&&t.onSet(),t.attributes&&this.set(t.attributes)):console.warn(`state "${e}" does not exist within this component`)}clear(){this.traverse((e=>{ue.disposeOf(e),e.material&&e.material.dispose(),e.geometry&&e.geometry.dispose()}))}}}function me(e){return class extends e{constructor(e){super(e),this.textUniforms={u_texture:{value:null},u_color:{value:null},u_opacity:{value:null},u_pxRange:{value:null},u_useRGSS:{value:null}},this.backgroundUniforms={u_texture:{value:null},u_color:{value:null},u_opacity:{value:null},u_backgroundMapping:{value:null},u_borderWidth:{value:null},u_borderColor:{value:null},u_borderRadiusTopLeft:{value:null},u_borderRadiusTopRight:{value:null},u_borderRadiusBottomRight:{value:null},u_borderRadiusBottomLeft:{value:null},u_borderOpacity:{value:null},u_size:{value:new n.Vector2(1,1)},u_tSize:{value:new n.Vector2(1,1)}}}updateBackgroundMaterial(){this.backgroundUniforms.u_texture.value=this.getBackgroundTexture(),this.backgroundUniforms.u_tSize.value.set(this.backgroundUniforms.u_texture.value.image.width,this.backgroundUniforms.u_texture.value.image.height),this.size&&this.backgroundUniforms.u_size.value.copy(this.size),this.backgroundUniforms.u_texture.value.isDefault?(this.backgroundUniforms.u_color.value=this.getBackgroundColor(),this.backgroundUniforms.u_opacity.value=this.getBackgroundOpacity()):(this.backgroundUniforms.u_color.value=this.backgroundColor||Ce.backgroundWhiteColor,this.backgroundUniforms.u_opacity.value=this.backgroundOpacity||0===this.backgroundOpacity?this.backgroundOpacity:Ce.backgroundOpaqueOpacity),this.backgroundUniforms.u_backgroundMapping.value=(()=>{switch(this.getBackgroundSize()){case"stretch":return 0;case"contain":return 1;case"cover":return 2}})();const e=this.getBorderRadius();this.backgroundUniforms.u_borderWidth.value=this.getBorderWidth(),this.backgroundUniforms.u_borderColor.value=this.getBorderColor(),this.backgroundUniforms.u_borderOpacity.value=this.getBorderOpacity(),Array.isArray(e)?(this.backgroundUniforms.u_borderRadiusTopLeft.value=e[0],this.backgroundUniforms.u_borderRadiusTopRight.value=e[1],this.backgroundUniforms.u_borderRadiusBottomRight.value=e[2],this.backgroundUniforms.u_borderRadiusBottomLeft.value=e[3]):(this.backgroundUniforms.u_borderRadiusTopLeft.value=e,this.backgroundUniforms.u_borderRadiusTopRight.value=e,this.backgroundUniforms.u_borderRadiusBottomRight.value=e,this.backgroundUniforms.u_borderRadiusBottomLeft.value=e)}updateTextMaterial(){this.textUniforms.u_texture.value=this.getFontTexture(),this.textUniforms.u_color.value=this.getFontColor(),this.textUniforms.u_opacity.value=this.getFontOpacity(),this.textUniforms.u_pxRange.value=this.getFontPXRange(),this.textUniforms.u_useRGSS.value=this.getFontSupersampling()}getBackgroundMaterial(){return this.backgroundMaterial&&this.backgroundUniforms||(this.backgroundMaterial=this._makeBackgroundMaterial()),this.backgroundMaterial}getFontMaterial(){return this.fontMaterial&&this.textUniforms||(this.fontMaterial=this._makeTextMaterial()),this.fontMaterial}_makeTextMaterial(){return new n.ShaderMaterial({uniforms:this.textUniforms,transparent:!0,clipping:!0,vertexShader:_e,fragmentShader:ye,extensions:{derivatives:!0}})}_makeBackgroundMaterial(){return new n.ShaderMaterial({uniforms:this.backgroundUniforms,transparent:!0,clipping:!0,vertexShader:be,fragmentShader:ve,extensions:{derivatives:!0}})}updateClippingPlanes(e){const t=void 0!==e?e:this.getClippingPlanes();JSON.stringify(t)!==JSON.stringify(this.clippingPlanes)&&(this.clippingPlanes=t,this.fontMaterial&&(this.fontMaterial.clippingPlanes=this.clippingPlanes),this.backgroundMaterial&&(this.backgroundMaterial.clippingPlanes=this.clippingPlanes))}}}const _e="\nvarying vec2 vUv;\n\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\tvUv = uv;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\tgl_Position.z -= 0.00001;\n\n\t#include <clipping_planes_vertex>\n\n}\n",ye="\n\nuniform sampler2D u_texture;\nuniform vec3 u_color;\nuniform float u_opacity;\nuniform float u_pxRange;\nuniform bool u_useRGSS;\n\nvarying vec2 vUv;\n\n#include <clipping_planes_pars_fragment>\n\n// functions from the original msdf repo:\n// https://github.com/Chlumsky/msdfgen#using-a-multi-channel-distance-field\n\nfloat median(float r, float g, float b) {\n\treturn max(min(r, g), min(max(r, g), b));\n}\n\nfloat screenPxRange() {\n\tvec2 unitRange = vec2(u_pxRange)/vec2(textureSize(u_texture, 0));\n\tvec2 screenTexSize = vec2(1.0)/fwidth(vUv);\n\treturn max(0.5*dot(unitRange, screenTexSize), 1.0);\n}\n\nfloat tap(vec2 offsetUV) {\n\tvec3 msd = texture( u_texture, offsetUV ).rgb;\n\tfloat sd = median(msd.r, msd.g, msd.b);\n\tfloat screenPxDistance = screenPxRange() * (sd - 0.5);\n\tfloat alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\n\treturn alpha;\n}\n\nvoid main() {\n\n\tfloat alpha;\n\n\tif ( u_useRGSS ) {\n\n\t\t// shader-based supersampling based on https://bgolus.medium.com/sharper-mipmapping-using-shader-based-supersampling-ed7aadb47bec\n\t\t// per pixel partial derivatives\n\t\tvec2 dx = dFdx(vUv);\n\t\tvec2 dy = dFdy(vUv);\n\n\t\t// rotated grid uv offsets\n\t\tvec2 uvOffsets = vec2(0.125, 0.375);\n\t\tvec2 offsetUV = vec2(0.0, 0.0);\n\n\t\t// supersampled using 2x2 rotated grid\n\t\talpha = 0.0;\n\t\toffsetUV.xy = vUv + uvOffsets.x * dx + uvOffsets.y * dy;\n\t\talpha += tap(offsetUV);\n\t\toffsetUV.xy = vUv - uvOffsets.x * dx - uvOffsets.y * dy;\n\t\talpha += tap(offsetUV);\n\t\toffsetUV.xy = vUv + uvOffsets.y * dx - uvOffsets.x * dy;\n\t\talpha += tap(offsetUV);\n\t\toffsetUV.xy = vUv - uvOffsets.y * dx + uvOffsets.x * dy;\n\t\talpha += tap(offsetUV);\n\t\talpha *= 0.25;\n\n\t} else {\n\n\t\talpha = tap( vUv );\n\n\t}\n\n\n\t// apply the opacity\n\talpha *= u_opacity;\n\n\t// this is useful to avoid z-fighting when quads overlap because of kerning\n\tif ( alpha < 0.02) discard;\n\n\n\tgl_FragColor = vec4( u_color, alpha );\n\n\t#include <clipping_planes_fragment>\n\n}\n",be="\nvarying vec2 vUv;\n\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\tvUv = uv;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\n\t#include <clipping_planes_vertex>\n\n}\n",ve="\n\nuniform sampler2D u_texture;\nuniform vec3 u_color;\nuniform float u_opacity;\n\nuniform float u_borderRadiusTopLeft;\nuniform float u_borderRadiusTopRight;\nuniform float u_borderRadiusBottomLeft;\nuniform float u_borderRadiusBottomRight;\nuniform float u_borderWidth;\nuniform vec3 u_borderColor;\nuniform float u_borderOpacity;\nuniform vec2 u_size;\nuniform vec2 u_tSize;\nuniform int u_backgroundMapping;\n\nvarying vec2 vUv;\n\n#include <clipping_planes_pars_fragment>\n\nfloat getEdgeDist() {\n\tvec2 ndc = vec2( vUv.x * 2.0 - 1.0, vUv.y * 2.0 - 1.0 );\n\tvec2 planeSpaceCoord = vec2( u_size.x * 0.5 * ndc.x, u_size.y * 0.5 * ndc.y );\n\tvec2 corner = u_size * 0.5;\n\tvec2 offsetCorner = corner - abs( planeSpaceCoord );\n\tfloat innerRadDist = min( offsetCorner.x, offsetCorner.y ) * -1.0;\n\tif (vUv.x < 0.5 && vUv.y >= 0.5) {\n\t\tfloat roundedDist = length( max( abs( planeSpaceCoord ) - u_size * 0.5 + u_borderRadiusTopLeft, 0.0 ) ) - u_borderRadiusTopLeft;\n\t\tfloat s = step( innerRadDist * -1.0, u_borderRadiusTopLeft );\n\t\treturn mix( innerRadDist, roundedDist, s );\n\t}\n\tif (vUv.x >= 0.5 && vUv.y >= 0.5) {\n\t\tfloat roundedDist = length( max( abs( planeSpaceCoord ) - u_size * 0.5 + u_borderRadiusTopRight, 0.0 ) ) - u_borderRadiusTopRight;\n\t\tfloat s = step( innerRadDist * -1.0, u_borderRadiusTopRight );\n\t\treturn mix( innerRadDist, roundedDist, s );\n\t}\n\tif (vUv.x >= 0.5 && vUv.y < 0.5) {\n\t\tfloat roundedDist = length( max( abs( planeSpaceCoord ) - u_size * 0.5 + u_borderRadiusBottomRight, 0.0 ) ) - u_borderRadiusBottomRight;\n\t\tfloat s = step( innerRadDist * -1.0, u_borderRadiusBottomRight );\n\t\treturn mix( innerRadDist, roundedDist, s );\n\t}\n\tif (vUv.x < 0.5 && vUv.y < 0.5) {\n\t\tfloat roundedDist = length( max( abs( planeSpaceCoord ) - u_size * 0.5 + u_borderRadiusBottomLeft, 0.0 ) ) - u_borderRadiusBottomLeft;\n\t\tfloat s = step( innerRadDist * -1.0, u_borderRadiusBottomLeft );\n\t\treturn mix( innerRadDist, roundedDist, s );\n\t}\n}\n\nvec4 sampleTexture() {\n\tfloat textureRatio = u_tSize.x / u_tSize.y;\n\tfloat panelRatio = u_size.x / u_size.y;\n\tvec2 uv = vUv;\n\tif ( u_backgroundMapping == 1 ) { // contain\n\t\tif ( textureRatio < panelRatio ) { // repeat on X\n\t\t\tfloat newX = uv.x * ( panelRatio / textureRatio );\n\t\t\tnewX += 0.5 - 0.5 * ( panelRatio / textureRatio );\n\t\t\tuv.x = newX;\n\t\t} else { // repeat on Y\n\t\t\tfloat newY = uv.y * ( textureRatio / panelRatio );\n\t\t\tnewY += 0.5 - 0.5 * ( textureRatio / panelRatio );\n\t\t\tuv.y = newY;\n\t\t}\n\t} else if ( u_backgroundMapping == 2 ) { // cover\n\t\tif ( textureRatio < panelRatio ) { // stretch on Y\n\t\t\tfloat newY = uv.y * ( textureRatio / panelRatio );\n\t\t\tnewY += 0.5 - 0.5 * ( textureRatio / panelRatio );\n\t\t\tuv.y = newY;\n\t\t} else { // stretch on X\n\t\t\tfloat newX = uv.x * ( panelRatio / textureRatio );\n\t\t\tnewX += 0.5 - 0.5 * ( panelRatio / textureRatio );\n\t\t\tuv.x = newX;\n\t\t}\n\t}\n\treturn texture2D( u_texture, uv ).rgba;\n}\n\nvoid main() {\n\n\tfloat edgeDist = getEdgeDist();\n\tfloat change = fwidth( edgeDist );\n\n\tvec4 textureSample = sampleTexture();\n\tvec3 blendedColor = textureSample.rgb * u_color;\n\n\tfloat alpha = smoothstep( change, 0.0, edgeDist );\n\tfloat blendedOpacity = u_opacity * textureSample.a * alpha;\n\n\tvec4 frameColor = vec4( blendedColor, blendedOpacity );\n\n\tif ( u_borderWidth <= 0.0 ) {\n\t\tgl_FragColor = frameColor;\n\t} else {\n\t\tvec4 borderColor = vec4( u_borderColor, u_borderOpacity * alpha );\n\t\tfloat stp = smoothstep( edgeDist + change, edgeDist, u_borderWidth * -1.0 );\n\t\tgl_FragColor = mix( frameColor, borderColor, stp );\n\t}\n\n\t#include <clipping_planes_fragment>\n}\n";class xe extends n.Mesh{constructor(e){super(new n.PlaneGeometry,e),this.castShadow=!0,this.receiveShadow=!0,this.name="MeshUI-Frame"}}let ke=null;function Re(...e){if(!ke)throw new Error("Cannot use mixins with Base null");let t=ke;ke=null;let s,r=e.length;for(;--r>=0;)s=e[r],t=s(t);return t}Re.withBase=e=>(ke=e,Re);class Ue extends(Re.withBase(n.Object3D)(I,Z,me,ge)){constructor(e){super(e),this.isBlock=!0,this.size=new n.Vector2(1,1),this.frame=new xe(this.getBackgroundMaterial()),this.frame.onBeforeRender=()=>{this.updateClippingPlanes&&this.updateClippingPlanes()},this.add(this.frame),this.set(e)}parseParams(){const e=this.getBestFit();"none"!=e&&this.childrenTexts.length?this.calculateBestFit(e):this.childrenTexts.forEach((e=>{e._fitFontSize=void 0}))}updateLayout(){const e=this.getWidth(),t=this.getHeight();e&&t?(this.size.set(e,t),this.frame.scale.set(e,t,1),this.frame&&this.updateBackgroundMaterial(),this.frame.renderOrder=this.getParentsNumber(),this.autoLayout&&this.setPosFromParentRecords(),this.childrenInlines.length&&this.computeInlinesPosition(),this.computeChildrenPosition(),this.parentUI&&(this.position.z=this.getOffset())):console.warn("Block got no dimension from its parameters or from children parameters")}updateInner(){this.parentUI&&(this.position.z=this.getOffset()),this.frame&&this.updateBackgroundMaterial()}}function Se(e){return class extends e{constructor(e){super(e),this.isInline=!0}}}const Ie=function e(t){t.children.forEach((s=>{s.children.length>0&&e(s),t.remove(s),ue.disposeOf(s),s.material&&s.material.dispose(),s.geometry&&s.geometry.dispose()})),t.children=[]};function Be(e){let t,s,r,a=0;for(let i=0;i<e.length;++i){const n=e[i];if(n.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(void 0===t&&(t=n.array.constructor),t!==n.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(void 0===s&&(s=n.itemSize),s!==n.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(void 0===r&&(r=n.normalized),r!==n.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;a+=n.array.length}const i=new t(a);let h=0;for(let t=0;t<e.length;++t)i.set(e[t].array,h),h+=e[t].array.length;return new n.BufferAttribute(i,s,r)}class Fe extends(Re.withBase(n.Object3D)(Se,me,ge)){constructor(e){super(),this.isText=!0,this._textContent=null,this._textContentGlyphs=null,this._textContentInlines=null,this.set(e),this.addEventListener("added",this._acquireFont)}set font(e){this._font&&!this._font.isReady&&this._font.removeEventListener("ready",this._handleFontVariantReady),this._font=e,this._font.isReady?this._handleFontVariantReady():(this.inlines=null,this._font.addEventListener("ready",this._handleFontVariantReady))}_handleFontVariantReady=()=>{this.update(!0,!0,!1),this.getHighestParent().update(!1,!0,!1),this._font.removeEventListener("ready",this._handleFontVariantReady)};_acquireFont=()=>{if(!this._font){let e=this.getFontFamily();if(e)if(e instanceof he)this.font=e.getVariant(this.getFontWeight(),this.getFontStyle());else{const t=e.pages?e.info.face:e;e=le.getFontFamily(t),e&&(this.font=e.getVariant(this.getFontWeight(),this.getFontStyle()))}}};_onBeforeRender=()=>{this.updateClippingPlanes&&this.updateClippingPlanes()};get font(){return this._font}_buildContentKernings(){if("none"!==this.getFontKerning())for(let e=1;e<this._textContent.length;e++){const t=this._textContent[e-1]+this._textContent[e];this._textContentInlines[e].kerning=this._font.getKerningAmount(t)}}parseParams(){this._acquireFont(),this.content&&0!==this.content.length&&this._font&&this._font.isReady&&(this._textContent=L(this.content,this.getWhiteSpace()),this._textContentGlyphs=this._textContent.split("").map((e=>this._font.getTypographyCharacter(e))),this._textContentInlines=this._textContentGlyphs.map((e=>e.asInlineCharacter())),this.inlines=this._textContentInlines,this.calculateInlines(this._fitFontSize||this.getFontSize()))}updateLayout(){if(Ie(this),this.inlines){const e=function(e,t=!1){const s=null!==e[0].index,r=new Set(Object.keys(e[0].attributes)),a=new Set(Object.keys(e[0].morphAttributes)),i={},h={},o=e[0].morphTargetsRelative,c=new n.BufferGeometry;let l=0;for(let n=0;n<e.length;++n){const d=e[n];let u=0;if(s!==(null!==d.index))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+n+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const e in d.attributes){if(!r.has(e))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+n+'. All geometries must have compatible attributes; make sure "'+e+'" attribute exists among all geometries, or in none of them.'),null;void 0===i[e]&&(i[e]=[]),i[e].push(d.attributes[e]),u++}if(u!==r.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+n+". Make sure all geometries have the same number of attributes."),null;if(o!==d.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+n+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const e in d.morphAttributes){if(!a.has(e))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+n+".  .morphAttributes must be consistent throughout all geometries."),null;void 0===h[e]&&(h[e]=[]),h[e].push(d.morphAttributes[e])}if(c.userData.mergedUserData=c.userData.mergedUserData||[],c.userData.mergedUserData.push(d.userData),t){let e;if(s)e=d.index.count;else{if(void 0===d.attributes.position)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+n+". The geometry must have either an index or a position attribute"),null;e=d.attributes.position.count}c.addGroup(l,e,n),l+=e}}if(s){let t=0;const s=[];for(let r=0;r<e.length;++r){const a=e[r].index;for(let e=0;e<a.count;++e)s.push(a.getX(e)+t);t+=e[r].attributes.position.count}c.setIndex(s)}for(const e in i){const t=Be(i[e]);if(!t)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+e+" attribute."),null;c.setAttribute(e,t)}for(const e in h){const t=h[e][0].length;if(0===t)break;c.morphAttributes=c.morphAttributes||{},c.morphAttributes[e]=[];for(let s=0;s<t;++s){const t=[];for(let r=0;r<h[e].length;++r)t.push(h[e][r][s]);const r=Be(t);if(!r)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+e+" morphAttribute."),null;c.morphAttributes[e].push(r)}}return c}(this.inlines.map((e=>this._font.getGeometryCharacter(e).translate(e.offsetX,e.offsetY,0))));this.textContent=new n.Mesh(e,this.getFontMaterial()),this.textContent.renderOrder=1/0,this.textContent.onBeforeRender=this._onBeforeRender,this.updateTextMaterial(),this.add(this.textContent)}this.position.z=this.getOffset()}updateInner(){this.position.z=this.getOffset(),this.textContent&&this.updateTextMaterial()}calculateInlines(e){if(!this._font||!this._font.isReady)return;if(!this._textContent)return;const t=this.getWhiteSpace(),s=A(t),r=this.getBreakOn(),a=e/this._font.typographic.size;for(let i=0;i<this._textContent.length;i++){const n=this._textContent[i],h=this._textContentInlines[i];h.resetOffsets();let o=null;t!==T&&(r.includes(n)||n.match(/\s/g))&&(o="possible"),n.match(/\n/g)&&(o=s),h.lineBreak=o,h.fontSize=e,h.fontFactor=a}}}class Te extends(Re.withBase(n.Object3D)(Se,I,Z,me,ge)){constructor(e){super(e),this.isInlineBlock=!0,this.size=new n.Vector2(1,1),this.frame=new xe(this.getBackgroundMaterial()),this.frame.onBeforeRender=()=>{this.updateClippingPlanes&&this.updateClippingPlanes()},this.add(this.frame),this.set(e)}parseParams(){this.width||console.warn("inlineBlock has no width. Set to 0.3 by default"),this.height||console.warn("inlineBlock has no height. Set to 0.3 by default"),this.inlines=[{lineBreak:"possible",kerning:0,offsetX:0,offsetY:0,width:this.width||.3,height:this.height||.3,anchor:0,xadvance:this.width||.3,xoffset:0,yoffset:0,lineHeight:this.height||.3,lineBase:this.height||.3}]}updateLayout(){const e=this.getWidth(),t=this.getHeight();if(this.inlines){const e=this.inlines[0];this.position.set(e.width/2,e.height/2,0),this.position.x+=e.offsetX,this.position.y+=e.offsetY,this.position.y+=e.anchor}this.size.set(e,t),this.frame.scale.set(e,t,1),this.frame&&this.updateBackgroundMaterial(),this.frame.renderOrder=this.getParentsNumber(),this.childrenInlines.length&&this.computeInlinesPosition(),this.computeChildrenPosition(),this.position.z=this.getOffset()}updateInner(){this.position.z=this.getOffset(),this.frame&&this.updateBackgroundMaterial()}}const Pe=[[[{width:.1,chars:[{lowerCase:"a",upperCase:"A"}]},{width:.1,chars:[{lowerCase:"z",upperCase:"Z"}]},{width:.1,chars:[{lowerCase:"e",upperCase:"E"}]},{width:.1,chars:[{lowerCase:"r",upperCase:"R"}]},{width:.1,chars:[{lowerCase:"t",upperCase:"T"}]},{width:.1,chars:[{lowerCase:"y",upperCase:"Y"}]},{width:.1,chars:[{lowerCase:"u",upperCase:"U"}]},{width:.1,chars:[{lowerCase:"i",upperCase:"I"}]},{width:.1,chars:[{lowerCase:"o",upperCase:"O"}]},{width:.1,chars:[{lowerCase:"p",upperCase:"P"}]}],[{width:.1,chars:[{lowerCase:"q",upperCase:"Q"}]},{width:.1,chars:[{lowerCase:"s",upperCase:"S"}]},{width:.1,chars:[{lowerCase:"d",upperCase:"D"}]},{width:.1,chars:[{lowerCase:"f",upperCase:"F"}]},{width:.1,chars:[{lowerCase:"g",upperCase:"G"}]},{width:.1,chars:[{lowerCase:"h",upperCase:"H"}]},{width:.1,chars:[{lowerCase:"j",upperCase:"J"}]},{width:.1,chars:[{lowerCase:"k",upperCase:"K"}]},{width:.1,chars:[{lowerCase:"l",upperCase:"L"}]},{width:.1,chars:[{lowerCase:"m",upperCase:"M"}]}],[{width:.2,command:"shift",chars:[{icon:"shift"}]},{width:.1,chars:[{lowerCase:"w",upperCase:"W"}]},{width:.1,chars:[{lowerCase:"x",upperCase:"X"}]},{width:.1,chars:[{lowerCase:"c",upperCase:"C"}]},{width:.1,chars:[{lowerCase:"v",upperCase:"V"}]},{width:.1,chars:[{lowerCase:"b",upperCase:"B"}]},{width:.1,chars:[{lowerCase:"n",upperCase:"N"}]},{width:.2,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]],[[{width:.1,chars:[{lowerCase:"1"}]},{width:.1,chars:[{lowerCase:"2"}]},{width:.1,chars:[{lowerCase:"3"}]},{width:.1,chars:[{lowerCase:"4"}]},{width:.1,chars:[{lowerCase:"5"}]},{width:.1,chars:[{lowerCase:"6"}]},{width:.1,chars:[{lowerCase:"7"}]},{width:.1,chars:[{lowerCase:"8"}]},{width:.1,chars:[{lowerCase:"9"}]},{width:.1,chars:[{lowerCase:"0"}]}],[{width:.1,chars:[{lowerCase:"@"}]},{width:.1,chars:[{lowerCase:"#"}]},{width:.1,chars:[{lowerCase:"|"}]},{width:.1,chars:[{lowerCase:"_"}]},{width:.1,chars:[{lowerCase:"&"}]},{width:.1,chars:[{lowerCase:"-"}]},{width:.1,chars:[{lowerCase:"+"}]},{width:.1,chars:[{lowerCase:"("}]},{width:.1,chars:[{lowerCase:")"}]},{width:.1,chars:[{lowerCase:"/"}]}],[{width:.1,chars:[{lowerCase:"="}]},{width:.1,chars:[{lowerCase:"*"}]},{width:.1,chars:[{lowerCase:'"'}]},{width:.1,chars:[{lowerCase:"'"}]},{width:.1,chars:[{lowerCase:":"}]},{width:.1,chars:[{lowerCase:";"}]},{width:.1,chars:[{lowerCase:"!"}]},{width:.1,chars:[{lowerCase:"?"}]},{width:.2,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]]],Oe=[[[{width:.1,chars:[{lowerCase:"q",upperCase:"Q"}]},{width:.1,chars:[{lowerCase:"w",upperCase:"W"}]},{width:.1,chars:[{lowerCase:"e",upperCase:"E"}]},{width:.1,chars:[{lowerCase:"r",upperCase:"R"}]},{width:.1,chars:[{lowerCase:"t",upperCase:"T"}]},{width:.1,chars:[{lowerCase:"y",upperCase:"Y"}]},{width:.1,chars:[{lowerCase:"u",upperCase:"U"}]},{width:.1,chars:[{lowerCase:"i",upperCase:"I"}]},{width:.1,chars:[{lowerCase:"o",upperCase:"O"}]},{width:.1,chars:[{lowerCase:"p",upperCase:"P"}]}],[{width:.1,chars:[{lowerCase:"a",upperCase:"A"}]},{width:.1,chars:[{lowerCase:"s",upperCase:"S"}]},{width:.1,chars:[{lowerCase:"d",upperCase:"D"}]},{width:.1,chars:[{lowerCase:"f",upperCase:"F"}]},{width:.1,chars:[{lowerCase:"g",upperCase:"G"}]},{width:.1,chars:[{lowerCase:"h",upperCase:"H"}]},{width:.1,chars:[{lowerCase:"j",upperCase:"J"}]},{width:.1,chars:[{lowerCase:"k",upperCase:"K"}]},{width:.1,chars:[{lowerCase:"l",upperCase:"L"}]}],[{width:.15,command:"shift",chars:[{icon:"shift"}]},{width:.1,chars:[{lowerCase:"z",upperCase:"Z"}]},{width:.1,chars:[{lowerCase:"x",upperCase:"X"}]},{width:.1,chars:[{lowerCase:"c",upperCase:"C"}]},{width:.1,chars:[{lowerCase:"v",upperCase:"V"}]},{width:.1,chars:[{lowerCase:"b",upperCase:"B"}]},{width:.1,chars:[{lowerCase:"n",upperCase:"N"}]},{width:.1,chars:[{lowerCase:"m",upperCase:"M"}]},{width:.15,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]],[[{width:.1,chars:[{lowerCase:"1"}]},{width:.1,chars:[{lowerCase:"2"}]},{width:.1,chars:[{lowerCase:"3"}]},{width:.1,chars:[{lowerCase:"4"}]},{width:.1,chars:[{lowerCase:"5"}]},{width:.1,chars:[{lowerCase:"6"}]},{width:.1,chars:[{lowerCase:"7"}]},{width:.1,chars:[{lowerCase:"8"}]},{width:.1,chars:[{lowerCase:"9"}]},{width:.1,chars:[{lowerCase:"0"}]}],[{width:.1,chars:[{lowerCase:"@"}]},{width:.1,chars:[{lowerCase:"#"}]},{width:.1,chars:[{lowerCase:"|"}]},{width:.1,chars:[{lowerCase:"_"}]},{width:.1,chars:[{lowerCase:"&"}]},{width:.1,chars:[{lowerCase:"-"}]},{width:.1,chars:[{lowerCase:"+"}]},{width:.1,chars:[{lowerCase:"("}]},{width:.1,chars:[{lowerCase:")"}]},{width:.1,chars:[{lowerCase:"/"}]}],[{width:.1,chars:[{lowerCase:"="}]},{width:.1,chars:[{lowerCase:"*"}]},{width:.1,chars:[{lowerCase:'"'}]},{width:.1,chars:[{lowerCase:"'"}]},{width:.1,chars:[{lowerCase:":"}]},{width:.1,chars:[{lowerCase:";"}]},{width:.1,chars:[{lowerCase:"!"}]},{width:.1,chars:[{lowerCase:"?"}]},{width:.2,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]]],Ee=[[[{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:"q",upperCase:"Q"}]},{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:"w",upperCase:"W"}]},{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:"e",upperCase:"E"}]},{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:"r",upperCase:"R"}]},{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:"t",upperCase:"T"}]},{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:"y",upperCase:"Y"}]},{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:"u",upperCase:"U"}]},{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:"i",upperCase:"I"}]},{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:"o",upperCase:"O"}]},{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:"p",upperCase:"P"}]},{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:"{",upperCase:"["}]},{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:"}",upperCase:"]"}]}],[{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:"a",upperCase:"A"}]},{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:"s",upperCase:"S"}]},{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:"d",upperCase:"D"}]},{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:"f",upperCase:"F"}]},{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:"g",upperCase:"G"}]},{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:"h",upperCase:"H"}]},{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:"j",upperCase:"J"}]},{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:"k",upperCase:"K"}]},{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:"l",upperCase:"L"}]},{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:":",upperCase:";"}]},{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:'"',upperCase:"'"}]},{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:"|",upperCase:"\\"}]}],[{width:.125,command:"shift",chars:[{icon:"shift"}]},{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:"z",upperCase:"Z"}]},{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:"x",upperCase:"X"}]},{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:"c",upperCase:"C"}]},{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:"v",upperCase:"V"}]},{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:"b",upperCase:"B"}]},{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:"n",upperCase:"N"}]},{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:"m",upperCase:"M"}]},{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:",",upperCase:""}]},{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:".",upperCase:""}]},{width:.125,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.15,command:"switch-set",chars:[{lowerCase:"eng"}]},{width:.15,command:"switch",chars:[{lowerCase:".?12"}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"?"}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]],[[{width:.1,chars:[{lowerCase:"1"}]},{width:.1,chars:[{lowerCase:"2"}]},{width:.1,chars:[{lowerCase:"3"}]},{width:.1,chars:[{lowerCase:"4"}]},{width:.1,chars:[{lowerCase:"5"}]},{width:.1,chars:[{lowerCase:"6"}]},{width:.1,chars:[{lowerCase:"7"}]},{width:.1,chars:[{lowerCase:"8"}]},{width:.1,chars:[{lowerCase:"9"}]},{width:.1,chars:[{lowerCase:"0"}]}],[{width:.1,chars:[{lowerCase:"@"}]},{width:.1,chars:[{lowerCase:"#"}]},{width:.1,chars:[{lowerCase:"|"}]},{width:.1,chars:[{lowerCase:"_"}]},{width:.1,chars:[{lowerCase:"&"}]},{width:.1,chars:[{lowerCase:"-"}]},{width:.1,chars:[{lowerCase:"+"}]},{width:.1,chars:[{lowerCase:"("}]},{width:.1,chars:[{lowerCase:")"}]},{width:.1,chars:[{lowerCase:"/"}]}],[{width:.1,chars:[{lowerCase:"="}]},{width:.1,chars:[{lowerCase:"*"}]},{width:.1,chars:[{lowerCase:'"'}]},{width:.1,chars:[{lowerCase:"'"}]},{width:.1,chars:[{lowerCase:":"}]},{width:.1,chars:[{lowerCase:";"}]},{width:.1,chars:[{lowerCase:"!"}]},{width:.1,chars:[{lowerCase:"?"}]},{width:.2,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.3,command:"switch",chars:[{lowerCase:""}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]]],ze=[[[{width:1/11,chars:[{lowerCase:"q",upperCase:"Q"}]},{width:1/11,chars:[{lowerCase:"w",upperCase:"W"}]},{width:1/11,chars:[{lowerCase:"e",upperCase:"E"}]},{width:1/11,chars:[{lowerCase:"r",upperCase:"R"}]},{width:1/11,chars:[{lowerCase:"t",upperCase:"T"}]},{width:1/11,chars:[{lowerCase:"z",upperCase:"Z"}]},{width:1/11,chars:[{lowerCase:"u",upperCase:"U"}]},{width:1/11,chars:[{lowerCase:"i",upperCase:"I"}]},{width:1/11,chars:[{lowerCase:"o",upperCase:"O"}]},{width:1/11,chars:[{lowerCase:"p",upperCase:"P"}]},{width:1/11,chars:[{lowerCase:"",upperCase:""}]}],[{width:1/11,chars:[{lowerCase:"a",upperCase:"A"}]},{width:1/11,chars:[{lowerCase:"s",upperCase:"S"}]},{width:1/11,chars:[{lowerCase:"d",upperCase:"D"}]},{width:1/11,chars:[{lowerCase:"f",upperCase:"F"}]},{width:1/11,chars:[{lowerCase:"g",upperCase:"G"}]},{width:1/11,chars:[{lowerCase:"h",upperCase:"H"}]},{width:1/11,chars:[{lowerCase:"j",upperCase:"J"}]},{width:1/11,chars:[{lowerCase:"k",upperCase:"K"}]},{width:1/11,chars:[{lowerCase:"l",upperCase:"L"}]},{width:1/11,chars:[{lowerCase:"",upperCase:""}]},{width:1/11,chars:[{lowerCase:"",upperCase:""}]}],[{width:2/11,command:"shift",chars:[{icon:"shift"}]},{width:1/11,chars:[{lowerCase:"y",upperCase:"Y"}]},{width:1/11,chars:[{lowerCase:"x",upperCase:"X"}]},{width:1/11,chars:[{lowerCase:"c",upperCase:"C"}]},{width:1/11,chars:[{lowerCase:"v",upperCase:"V"}]},{width:1/11,chars:[{lowerCase:"b",upperCase:"B"}]},{width:1/11,chars:[{lowerCase:"n",upperCase:"N"}]},{width:1/11,chars:[{lowerCase:"m",upperCase:"M"}]},{width:2/11,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]],[[{width:.1,chars:[{lowerCase:"1"}]},{width:.1,chars:[{lowerCase:"2"}]},{width:.1,chars:[{lowerCase:"3"}]},{width:.1,chars:[{lowerCase:"4"}]},{width:.1,chars:[{lowerCase:"5"}]},{width:.1,chars:[{lowerCase:"6"}]},{width:.1,chars:[{lowerCase:"7"}]},{width:.1,chars:[{lowerCase:"8"}]},{width:.1,chars:[{lowerCase:"9"}]},{width:.1,chars:[{lowerCase:"0"}]}],[{width:.1,chars:[{lowerCase:"@"}]},{width:.1,chars:[{lowerCase:"#"}]},{width:.1,chars:[{lowerCase:"|"}]},{width:.1,chars:[{lowerCase:"_"}]},{width:.1,chars:[{lowerCase:"&"}]},{width:.1,chars:[{lowerCase:"-"}]},{width:.1,chars:[{lowerCase:"+"}]},{width:.1,chars:[{lowerCase:"("}]},{width:.1,chars:[{lowerCase:")"}]},{width:.1,chars:[{lowerCase:"/"}]}],[{width:.1,chars:[{lowerCase:"="}]},{width:.1,chars:[{lowerCase:"*"}]},{width:.1,chars:[{lowerCase:'"'}]},{width:.1,chars:[{lowerCase:"'"}]},{width:.1,chars:[{lowerCase:":"}]},{width:.1,chars:[{lowerCase:";"}]},{width:.1,chars:[{lowerCase:"!"}]},{width:.1,chars:[{lowerCase:"?"}]},{width:.2,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]]],He=[[[{width:.1,chars:[{lowerCase:"q",upperCase:"Q"}]},{width:.1,chars:[{lowerCase:"w",upperCase:"W"}]},{width:.1,chars:[{lowerCase:"e",upperCase:"E"}]},{width:.1,chars:[{lowerCase:"r",upperCase:"R"}]},{width:.1,chars:[{lowerCase:"t",upperCase:"T"}]},{width:.1,chars:[{lowerCase:"y",upperCase:"Y"}]},{width:.1,chars:[{lowerCase:"u",upperCase:"U"}]},{width:.1,chars:[{lowerCase:"i",upperCase:"I"}]},{width:.1,chars:[{lowerCase:"o",upperCase:"O"}]},{width:.1,chars:[{lowerCase:"p",upperCase:"P"}]}],[{width:.1,chars:[{lowerCase:"a",upperCase:"A"}]},{width:.1,chars:[{lowerCase:"s",upperCase:"S"}]},{width:.1,chars:[{lowerCase:"d",upperCase:"D"}]},{width:.1,chars:[{lowerCase:"f",upperCase:"F"}]},{width:.1,chars:[{lowerCase:"g",upperCase:"G"}]},{width:.1,chars:[{lowerCase:"h",upperCase:"H"}]},{width:.1,chars:[{lowerCase:"j",upperCase:"J"}]},{width:.1,chars:[{lowerCase:"k",upperCase:"K"}]},{width:.1,chars:[{lowerCase:"l",upperCase:"L"}]},{width:.1,chars:[{lowerCase:"",upperCase:""}]}],[{width:.15,command:"shift",chars:[{icon:"shift"}]},{width:.1,chars:[{lowerCase:"z",upperCase:"Z"}]},{width:.1,chars:[{lowerCase:"x",upperCase:"X"}]},{width:.1,chars:[{lowerCase:"c",upperCase:"C"}]},{width:.1,chars:[{lowerCase:"v",upperCase:"V"}]},{width:.1,chars:[{lowerCase:"b",upperCase:"B"}]},{width:.1,chars:[{lowerCase:"n",upperCase:"N"}]},{width:.1,chars:[{lowerCase:"m",upperCase:"M"}]},{width:.15,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]],[[{width:.1,chars:[{lowerCase:"1"}]},{width:.1,chars:[{lowerCase:"2"}]},{width:.1,chars:[{lowerCase:"3"}]},{width:.1,chars:[{lowerCase:"4"}]},{width:.1,chars:[{lowerCase:"5"}]},{width:.1,chars:[{lowerCase:"6"}]},{width:.1,chars:[{lowerCase:"7"}]},{width:.1,chars:[{lowerCase:"8"}]},{width:.1,chars:[{lowerCase:"9"}]},{width:.1,chars:[{lowerCase:"0"}]}],[{width:.1,chars:[{lowerCase:"@"}]},{width:.1,chars:[{lowerCase:"#"}]},{width:.1,chars:[{lowerCase:"|"}]},{width:.1,chars:[{lowerCase:"_"}]},{width:.1,chars:[{lowerCase:"&"}]},{width:.1,chars:[{lowerCase:"-"}]},{width:.1,chars:[{lowerCase:"+"}]},{width:.1,chars:[{lowerCase:"("}]},{width:.1,chars:[{lowerCase:")"}]},{width:.1,chars:[{lowerCase:"/"}]}],[{width:.1,chars:[{lowerCase:"="}]},{width:.1,chars:[{lowerCase:"*"}]},{width:.1,chars:[{lowerCase:'"'}]},{width:.1,chars:[{lowerCase:"'"}]},{width:.1,chars:[{lowerCase:":"}]},{width:.1,chars:[{lowerCase:";"}]},{width:.1,chars:[{lowerCase:"!"}]},{width:.1,chars:[{lowerCase:"?"}]},{width:.2,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]]],Le=[[[{width:.1,chars:[{lowerCase:";",upperCase:":"},{lowerCase:"q",upperCase:"Q"}]},{width:.1,chars:[{lowerCase:"",upperCase:""},{lowerCase:"w",upperCase:"W"}]},{width:.1,chars:[{lowerCase:"",upperCase:""},{lowerCase:"e",upperCase:"E"}]},{width:.1,chars:[{lowerCase:"",upperCase:""},{lowerCase:"r",upperCase:"R"}]},{width:.1,chars:[{lowerCase:"",upperCase:""},{lowerCase:"t",upperCase:"T"}]},{width:.1,chars:[{lowerCase:"",upperCase:""},{lowerCase:"y",upperCase:"Y"}]},{width:.1,chars:[{lowerCase:"",upperCase:""},{lowerCase:"u",upperCase:"U"}]},{width:.1,chars:[{lowerCase:"",upperCase:""},{lowerCase:"i",upperCase:"I"}]},{width:.1,chars:[{lowerCase:"",upperCase:""},{lowerCase:"o",upperCase:"O"}]},{width:.1,chars:[{lowerCase:"",upperCase:""},{lowerCase:"p",upperCase:"P"}]}],[{width:.1,chars:[{lowerCase:"",upperCase:""},{lowerCase:"a",upperCase:"A"}]},{width:.1,chars:[{lowerCase:"",upperCase:""},{lowerCase:"s",upperCase:"S"}]},{width:.1,chars:[{lowerCase:"",upperCase:""},{lowerCase:"d",upperCase:"D"}]},{width:.1,chars:[{lowerCase:"",upperCase:""},{lowerCase:"f",upperCase:"F"}]},{width:.1,chars:[{lowerCase:"",upperCase:""},{lowerCase:"g",upperCase:"G"}]},{width:.1,chars:[{lowerCase:"",upperCase:""},{lowerCase:"h",upperCase:"H"}]},{width:.1,chars:[{lowerCase:"",upperCase:""},{lowerCase:"j",upperCase:"J"}]},{width:.1,chars:[{lowerCase:"",upperCase:""},{lowerCase:"k",upperCase:"K"}]},{width:.1,chars:[{lowerCase:"",upperCase:""},{lowerCase:"l",upperCase:"L"}]}],[{width:.15,command:"shift",chars:[{icon:"shift"}]},{width:.1,chars:[{lowerCase:"",upperCase:""},{lowerCase:"z",upperCase:"Z"}]},{width:.1,chars:[{lowerCase:"",upperCase:""},{lowerCase:"x",upperCase:"X"}]},{width:.1,chars:[{lowerCase:"",upperCase:""},{lowerCase:"c",upperCase:"C"}]},{width:.1,chars:[{lowerCase:"",upperCase:""},{lowerCase:"v",upperCase:"V"}]},{width:.1,chars:[{lowerCase:"",upperCase:""},{lowerCase:"b",upperCase:"B"}]},{width:.1,chars:[{lowerCase:"",upperCase:""},{lowerCase:"n",upperCase:"N"}]},{width:.1,chars:[{lowerCase:"",upperCase:""},{lowerCase:"m",upperCase:"M"}]},{width:.15,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.15,command:"switch-set",chars:[{lowerCase:"eng"}]},{width:.15,command:"switch",chars:[{lowerCase:".?12"}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"?"}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]],[[{width:.1,chars:[{lowerCase:"1"}]},{width:.1,chars:[{lowerCase:"2"}]},{width:.1,chars:[{lowerCase:"3"}]},{width:.1,chars:[{lowerCase:"4"}]},{width:.1,chars:[{lowerCase:"5"}]},{width:.1,chars:[{lowerCase:"6"}]},{width:.1,chars:[{lowerCase:"7"}]},{width:.1,chars:[{lowerCase:"8"}]},{width:.1,chars:[{lowerCase:"9"}]},{width:.1,chars:[{lowerCase:"0"}]}],[{width:.1,chars:[{lowerCase:"@"}]},{width:.1,chars:[{lowerCase:"#"}]},{width:.1,chars:[{lowerCase:"|"}]},{width:.1,chars:[{lowerCase:"_"}]},{width:.1,chars:[{lowerCase:"&"}]},{width:.1,chars:[{lowerCase:"-"}]},{width:.1,chars:[{lowerCase:"+"}]},{width:.1,chars:[{lowerCase:"("}]},{width:.1,chars:[{lowerCase:")"}]},{width:.1,chars:[{lowerCase:"/"}]}],[{width:.1,chars:[{lowerCase:"="}]},{width:.1,chars:[{lowerCase:"*"}]},{width:.1,chars:[{lowerCase:'"'}]},{width:.1,chars:[{lowerCase:"'"}]},{width:.1,chars:[{lowerCase:":"}]},{width:.1,chars:[{lowerCase:";"}]},{width:.1,chars:[{lowerCase:"!"}]},{width:.1,chars:[{lowerCase:"?"}]},{width:.2,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]]],Ae=[[[{width:1/11,chars:[{lowerCase:"q",upperCase:"Q"}]},{width:1/11,chars:[{lowerCase:"w",upperCase:"W"}]},{width:1/11,chars:[{lowerCase:"e",upperCase:"E"}]},{width:1/11,chars:[{lowerCase:"r",upperCase:"R"}]},{width:1/11,chars:[{lowerCase:"t",upperCase:"T"}]},{width:1/11,chars:[{lowerCase:"y",upperCase:"Y"}]},{width:1/11,chars:[{lowerCase:"u",upperCase:"U"}]},{width:1/11,chars:[{lowerCase:"i",upperCase:"I"}]},{width:1/11,chars:[{lowerCase:"o",upperCase:"O"}]},{width:1/11,chars:[{lowerCase:"p",upperCase:"P"}]},{width:1/11,chars:[{lowerCase:"",upperCase:""}]}],[{width:1/11,chars:[{lowerCase:"a",upperCase:"A"}]},{width:1/11,chars:[{lowerCase:"s",upperCase:"S"}]},{width:1/11,chars:[{lowerCase:"d",upperCase:"D"}]},{width:1/11,chars:[{lowerCase:"f",upperCase:"F"}]},{width:1/11,chars:[{lowerCase:"g",upperCase:"G"}]},{width:1/11,chars:[{lowerCase:"h",upperCase:"H"}]},{width:1/11,chars:[{lowerCase:"j",upperCase:"J"}]},{width:1/11,chars:[{lowerCase:"k",upperCase:"K"}]},{width:1/11,chars:[{lowerCase:"l",upperCase:"L"}]},{width:1/11,chars:[{lowerCase:"",upperCase:""}]},{width:1/11,chars:[{lowerCase:"",upperCase:""}]}],[{width:2/11,command:"shift",chars:[{icon:"shift"}]},{width:1/11,chars:[{lowerCase:"z",upperCase:"Z"}]},{width:1/11,chars:[{lowerCase:"x",upperCase:"X"}]},{width:1/11,chars:[{lowerCase:"c",upperCase:"C"}]},{width:1/11,chars:[{lowerCase:"v",upperCase:"V"}]},{width:1/11,chars:[{lowerCase:"b",upperCase:"B"}]},{width:1/11,chars:[{lowerCase:"n",upperCase:"N"}]},{width:1/11,chars:[{lowerCase:"m",upperCase:"M"}]},{width:2/11,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]],[[{width:.1,chars:[{lowerCase:"1"}]},{width:.1,chars:[{lowerCase:"2"}]},{width:.1,chars:[{lowerCase:"3"}]},{width:.1,chars:[{lowerCase:"4"}]},{width:.1,chars:[{lowerCase:"5"}]},{width:.1,chars:[{lowerCase:"6"}]},{width:.1,chars:[{lowerCase:"7"}]},{width:.1,chars:[{lowerCase:"8"}]},{width:.1,chars:[{lowerCase:"9"}]},{width:.1,chars:[{lowerCase:"0"}]}],[{width:.1,chars:[{lowerCase:"@"}]},{width:.1,chars:[{lowerCase:"#"}]},{width:.1,chars:[{lowerCase:"|"}]},{width:.1,chars:[{lowerCase:"_"}]},{width:.1,chars:[{lowerCase:"&"}]},{width:.1,chars:[{lowerCase:"-"}]},{width:.1,chars:[{lowerCase:"+"}]},{width:.1,chars:[{lowerCase:"("}]},{width:.1,chars:[{lowerCase:")"}]},{width:.1,chars:[{lowerCase:"/"}]}],[{width:.1,chars:[{lowerCase:"="}]},{width:.1,chars:[{lowerCase:"*"}]},{width:.1,chars:[{lowerCase:'"'}]},{width:.1,chars:[{lowerCase:"'"}]},{width:.1,chars:[{lowerCase:":"}]},{width:.1,chars:[{lowerCase:";"}]},{width:.1,chars:[{lowerCase:"!"}]},{width:.1,chars:[{lowerCase:"?"}]},{width:.2,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]]],De=new n.TextureLoader;class We extends(Re.withBase(n.Object3D)(I,ge)){constructor(e){let t;if(e||(e={}),e.width||(e.width=1),e.height||(e.height=.4),e.margin||(e.margin=.003),e.padding||(e.padding=.01),super(e),this.currentPanel=0,this.isLowerCase=!0,this.charsetCount=1,e.language||navigator.language)switch(e.language||navigator.language){case"fr":case"fr-CH":case"fr-CA":t=Pe;break;case"ru":this.charsetCount=2,t=Ee;break;case"de":case"de-DE":case"de-AT":case"de-LI":case"de-CH":t=ze;break;case"es":case"es-419":case"es-AR":case"es-CL":case"es-CO":case"es-ES":case"es-CR":case"es-US":case"es-HN":case"es-MX":case"es-PE":case"es-UY":case"es-VE":t=He;break;case"el":this.charsetCount=2,t=Le;break;case"nord":t=Ae;break;default:t=Oe}else t=Oe;this.keys=[],this.panels=t.map((t=>{const s=e.height/t.length-2*e.margin,r=new Ue({width:e.width+2*e.padding,height:e.height+2*e.padding,offset:0,padding:e.padding,fontFamily:e.fontFamily,fontTexture:e.fontTexture,backgroundColor:e.backgroundColor,backgroundOpacity:e.backgroundOpacity});return r.charset=0,r.add(...t.map((t=>{const a=new Ue({width:e.width,height:s,margin:e.margin,contentDirection:"row",justifyContent:"center"});a.frame.visible=!1;const i=[];return t.forEach((t=>{const a=new Ue({width:e.width*t.width-2*e.margin,height:s,margin:e.margin,justifyContent:"center",offset:0}),n=t.chars[r.charset].lowerCase||t.chars[r.charset].icon||"undif";if("enter"===n&&e.enterTexture||"shift"===n&&e.shiftTexture||"backspace"===n&&e.backspaceTexture){const t=(()=>{switch(n){case"backspace":return e.backspaceTexture;case"enter":return e.enterTexture;case"shift":return e.shiftTexture;default:console.warn("There is no icon image for this key")}})();De.load(t,(e=>{a.add(new Te({width:.65*a.width,height:.65*a.height,backgroundSize:"contain",backgroundTexture:e}))}))}else a.add(new Fe({content:n,offset:0}));a.type="Key",a.info=t,a.info.input=n,a.panel=r,i.push(a),this.keys.push(a)})),a.add(...i),a}))),r})),this.add(this.panels[0]),this.set(e)}setNextPanel(){this.panels.forEach((e=>{this.remove(e)})),this.currentPanel=(this.currentPanel+1)%this.panels.length,this.add(this.panels[this.currentPanel]),this.update(!0,!0,!0)}setNextCharset(){this.panels[this.currentPanel].charset=(this.panels[this.currentPanel].charset+1)%this.charsetCount,this.keys.forEach((e=>{if(!this.panels[this.currentPanel].getObjectById(e.id))return;const t=e.info.chars[e.panel.charset]||e.info.chars[0],s=this.isLowerCase||!t.upperCase?t.lowerCase:t.upperCase;if(!e.childrenTexts.length)return;const r=e.childrenTexts[0];e.info.input=s,r.set({content:s}),r.update(!0,!0,!0)}))}toggleCase(){this.isLowerCase=!this.isLowerCase,this.keys.forEach((e=>{const t=e.info.chars[e.panel.charset]||e.info.chars[0],s=this.isLowerCase||!t.upperCase?t.lowerCase:t.upperCase;if(!e.childrenTexts.length)return;const r=e.childrenTexts[0];e.info.input=s,r.set({content:s}),r.update(!0,!0,!0)}))}parseParams(){}updateLayout(){}updateInner(){}}const Me={Block:Ue,Text:Fe,InlineBlock:Te,Keyboard:We,FontLibrary:le,update:()=>ue.update(),TextAlign:i,Whitespace:a,JustifyContent:r,AlignItems:s,ContentDirection:t};void 0!==e.g&&(e.g.ThreeMeshUI=Me)})();